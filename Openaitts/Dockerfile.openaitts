# Openaitts/Dockerfile.openaitts
FROM python:3.10-slim

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    SHARED_DIR=/app/shared_data_workspace \
    PORT=8005

# 기본 유틸 & ffmpeg
RUN apt-get update && apt-get install -y --no-install-recommends \
    ffmpeg curl ca-certificates \
 && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# 런타임 패키지 (버전 고정 권장)

RUN pip install --no-cache-dir \
    "httpx==0.27.2" \
    "openai==1.51.*" \
    "fastapi==0.115.*" "uvicorn==0.30.*" \
    "python-multipart==0.0.*" "python-dotenv==1.0.*"

# 앱 소스
COPY openaitts_api_server.py /app/openaitts_api_server.py

EXPOSE 8005

# 프록시 운영 고려 옵션(원하시면 --proxy-headers 부분 제거 가능)
CMD ["uvicorn", "openaitts_api_server:app", "--host", "0.0.0.0", "--port", "8005", "--proxy-headers", "--forwarded-allow-ips=*"]